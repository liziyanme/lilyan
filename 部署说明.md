# LZY's Diary — 部署到 Vercel 说明

部署后可在手机、平板、电脑多端访问，同一账号多设备同时登录。

---

## 部署前检查

1. **Supabase 建表**：在 Supabase → SQL Editor 执行：
   - `supabase-schema.sql`（主表）
   - `supabase-rls-auth.sql`（登录隔离）
   - `supabase-comment.sql`（评论表，可选）
   - `supabase-notebook.sql`（日记本：写日记时可选择不同本子，可选）
   - `supabase-draft.sql`（草稿箱：未写完可保存为草稿，可选）
2. **Storage 桶**：Supabase → Storage → 新建 `diary-images` 公开桶
3. **Confirm email**：建议关闭（Supabase → Auth → Email → Confirm email 关）

---

## 1. 推送到 GitHub

1. 在项目根目录（c:\diary）打开终端
2. 若未初始化 git，执行：
   ```
   git init
   git add .
   git commit -m "Initial commit"
   ```
3. 到 [GitHub](https://github.com) 新建仓库（如 `lzy-diary`）
4. 执行（替换为你的仓库地址）：
   ```
   git remote add origin https://github.com/你的用户名/lzy-diary.git
   git branch -M main
   git push -u origin main
   ```

---

## 2. 部署到 Vercel

1. 打开 [vercel.com](https://vercel.com)，用 GitHub 登录
2. 点 **Add New** → **Project**
3. 选择你的 `lzy-diary` 仓库，点 **Import**
4. **Environment Variables** 里添加：
   - `NEXT_PUBLIC_SUPABASE_URL` = 你的 Supabase URL
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY` = 你的 anon 公钥（eyJ 开头）
5. 点 **Deploy**

---

## 3. Supabase 配置

部署成功后 Vercel 会给你一个域名（如 `lzy-diary.vercel.app`）。

1. 打开 [Supabase Dashboard](https://supabase.com/dashboard) → 你的项目
2. **Authentication** → **URL Configuration**
3. **Site URL** 填：`https://你的vercel域名.vercel.app`
4. **Redirect URLs** 添加：
   - `https://你的vercel域名.vercel.app/**`
   - `http://localhost:3000/**`（本地开发保留）

---

## 4. 绑定自己的域名（可选）

1. 在 Vercel 项目里点 **Settings** → **Domains**
2. 添加你的域名，按提示到域名服务商做 CNAME 解析
3. 解析生效后，到 Supabase 的 **URL Configuration** 里，把新域名也加入 **Site URL** 和 **Redirect URLs**

---

## 5. 多设备使用

部署完成后，用手机、平板、电脑浏览器打开你的网站，同一个账号登录，数据会同步。

---

## 6. 访客统计（可选）

项目已内置访客记录：每次页面访问会向 Supabase 的 `visitor` 表写入一条记录（IP、User-Agent、访问路径）。在 Supabase → **Table Editor** → **visitor** 可查看。若未执行过 `supabase-schema.sql`，则无此表，不影响其他功能。

---

## 常见问题

- **登录失败**：检查 Supabase → Auth → URL Configuration 是否添加了 Vercel 域名
- **评论不显示**：在 Supabase SQL Editor 执行 `supabase-comment.sql` 创建评论表
